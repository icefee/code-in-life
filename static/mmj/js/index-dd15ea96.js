import{H as j,j as T,o as S,c as N,a as s,K as G,u as o,I as Y,F as _e,a8 as ye,ah as M,Q as K,W as ee,T as C,U as A,V as i,P as c,O as J,B as ne,aw as se,ax as ie,e as V,S as U,s as ae,i as me,Z as be,n as Se,a3 as ce,ar as Le,a9 as Me,J as ue,as as Pe}from"./_@vue-e00bfe83.js";import{M as de,Q as Ie,R as Ve,S as te,T as Te,U as we,P as xe,V as $e}from"./_@element-plus-0c795a89.js";import{E as Z,a as ke,i as Ne}from"./_element-plus-9fd6eb85.js";import"./__vendor-6a03e462.js";import"./_@popperjs-c45de710.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))_(a);new MutationObserver(a=>{for(const v of a)if(v.type==="childList")for(const e of v.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&_(e)}).observe(document,{childList:!0,subtree:!0});function u(a){const v={};return a.integrity&&(v.integrity=a.integrity),a.referrerPolicy&&(v.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?v.credentials="include":a.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function _(a){if(a.ep)return;a.ep=!0;const v=u(a);fetch(a.href,v)}})();const Ce={class:"rect-jump-comp"},Oe=j({__name:"reactJump",props:{running:{type:Boolean,default:!0}},setup(d){const p=d,u=T(()=>p.running?"running":"paused"),_=T(h=>({animation:".5s linear .8s infinite alternate slidein "+u.value})),a=T(h=>({animation:".5s linear .6s infinite alternate slidein "+u.value})),v=T(h=>({animation:".5s linear .4s infinite alternate slidein "+u.value})),e=T(h=>({animation:".5s linear 0s infinite alternate slidein "+u.value}));return(h,n)=>(S(),N("div",Ce,[s("div",{class:"a",ref:"aRef",style:G(o(_))},null,4),s("div",{class:"b",style:G(o(a))},null,4),s("div",{class:"c",style:G(o(v))},null,4),s("div",{class:"d",style:G(o(e))},null,4)]))}});const W=(d,p)=>{const u=d.__vccOpts||d;for(const[_,a]of p)u[_]=a;return u},ze=W(Oe,[["__scopeId","data-v-58feb480"]]),Re={class:"music-list-container"},Be={class:"searchResult"},Ee=["onClick"],He=["onClick"],Je={class:"musicName textHiddenEllipsis"},Ae={class:"artist"},je={class:"right"},Ue=j({__name:"musicList",props:{modelValue:{default:()=>[]},currentPlayingObj:{default:()=>({})},hideListNumResult:{type:Boolean,default:!1}},emits:["getLrc"],setup(d,{emit:p}){const u=d,_=T(()=>u.modelValue),a=e=>{p("getLrc",e)},v=e=>{console.log(e)};return(e,h)=>{const n=M("el-skeleton-item"),L=M("el-skeleton"),t=M("el-image"),P=M("MoreFilled"),y=M("el-icon");return S(),N("div",Re,[Y(e.$slots,"listNumResult",{},()=>[K(s("div",Be,[C("共 "),s("b",null,A(o(_).length),1),C(" 个搜索结果")],512),[[ee,!d.hideListNumResult]])],!0),(S(!0),N(_e,null,ye(o(_),(b,O)=>(S(),N("div",{class:"lists",key:b.id+b.name},[Y(e.$slots,"content",{row:b},()=>[Y(e.$slots,"leftContent",{row:b},()=>[(S(),N("div",{class:"left cursorPointer",onClick:H=>a(b),key:b.id+b.name},[i(t,{src:b.poster,style:{width:"44px",height:"44px","border-radius":"50%"},onError:v},{error:c(()=>[i(L,{class:"imgIsError",style:{width:"44px",height:"44px"}},{template:c(()=>[i(n,{variant:"circle"})]),_:1})]),placeholder:c(()=>[i(L,{animated:"",class:"imgIsLoading"},{template:c(()=>[i(n,{class:"defaultImg",variant:"image",style:{width:"44px",height:"44px"}})]),_:1})]),_:2},1032,["src"]),K(i(ze,{running:!d.currentPlayingObj.loadingLrc&&b.id===d.currentPlayingObj.id&&d.currentPlayingObj.isPlaying},null,8,["running"]),[[ee,b.id===d.currentPlayingObj.id]])],8,Ee))],!0),Y(e.$slots,"centerContent",{row:b},()=>[s("div",{class:"center cursorPointer",onClick:H=>a(b)},[s("div",Je,A(b.name),1),s("div",Ae,A(b.artist),1)],8,He)],!0),Y(e.$slots,"rightContent",{row:b},()=>[s("div",je,[i(y,null,{default:c(()=>[i(P)]),_:1})])],!0)],!0)]))),128))])}}});const ve=W(Ue,[["__scopeId","data-v-84a33b9b"]]),We=d=>(se("data-v-34de13eb"),d=d(),ie(),d),De=We(()=>s("div",{class:"loading-circle-container"},[s("div",{class:"left"},[s("div",{class:"outer-circle"},[s("div",{class:"inner-circle"})])]),s("div",{class:"right"},"搜索中...")],-1)),Fe=j({__name:"loadingGlobal",props:{loading:{type:Boolean,default:!0},value:{type:Number,default:0},max:{type:Number,default:1}},emits:["update:modelValue"],setup(d,{emit:p}){const u=d,_=T({get:()=>u.loading,set:a=>{p("update:modelValue",a)}});return(a,v)=>{const e=M("el-dialog");return S(),J(e,{class:"loading-circle-dialog",modelValue:o(_),"onUpdate:modelValue":v[0]||(v[0]=h=>ne(_)?_.value=h:null),width:"100px","close-on-click-modal":!1,"show-close":!1,top:"40vh"},{default:c(()=>[De]),_:1},8,["modelValue"])}}});const Ge=W(Fe,[["__scopeId","data-v-34de13eb"]]),le=d=>(se("data-v-53a3d29d"),d=d(),ie(),d),Ke={class:"volumn-comp"},Qe={class:"icon-origin"},Xe=le(()=>s("svg",{class:"MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-i4bv87-MuiSvgIcon-root",focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24","data-testid":"VolumeOffIcon"},[s("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4 9.91 6.09 12 8.18V4z"})],-1)),qe=le(()=>s("svg",{class:"MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-i4bv87-MuiSvgIcon-root",focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24","data-testid":"VolumeUpIcon"},[s("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)),Ye={class:"volumn-comp vertical"},Ze={class:"volumn-comp progress"},et={class:"icon"},tt=le(()=>s("svg",{class:"MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-i4bv87-MuiSvgIcon-root",focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24","data-testid":"VolumeOffIcon"},[s("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4 9.91 6.09 12 8.18V4z"})],-1)),lt=le(()=>s("svg",{class:"MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-i4bv87-MuiSvgIcon-root",focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24","data-testid":"VolumeUpIcon"},[s("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)),ot=j({__name:"volume",emits:["change"],setup(d,{emit:p}){let _=localStorage.getItem("_volume");const a=_?V(Number(JSON.parse(_))):V(.4),v=V(0),e=L=>{localStorage.setItem("_volume",String(L)),p("change",String(L)),v.value=Number(L)||.4},h=(L=!0)=>{if(L?p("change",String(v.value||.4)):p("change",String(0)),L){a.value=v.value?v.value:.4;return}a.value=.4},n=L=>L*100;return(L,t)=>{const P=M("el-icon"),y=M("el-slider"),b=M("el-dropdown");return S(),N("div",Ke,[i(b,{trigger:"click"},{dropdown:c(()=>[s("div",Ye,[s("div",Ze,[i(y,{modelValue:o(a),"onUpdate:modelValue":[t[0]||(t[0]=O=>ne(a)?a.value=O:null),e],max:1,step:.1,vertical:"",height:"100px","format-tooltip":n},null,8,["modelValue","step"])]),s("div",et,[o(a)?(S(),J(P,{key:1,onClick:t[2]||(t[2]=O=>h(!1))},{default:c(()=>[lt]),_:1})):(S(),J(P,{key:0,onClick:t[1]||(t[1]=O=>h(!0))},{default:c(()=>[tt]),_:1}))])])]),default:c(()=>[s("span",Qe,[o(a)?(S(),J(P,{key:1},{default:c(()=>[qe]),_:1})):(S(),J(P,{key:0},{default:c(()=>[Xe]),_:1}))])]),_:1})])}}});const at=W(ot,[["__scopeId","data-v-53a3d29d"]]),pe=d=>(se("data-v-a527a3be"),d=d(),ie(),d),nt={class:"repeat-mode-container"},st=pe(()=>s("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4zm-4-2V9h-1l-2 1v1h1.5v4H13z"},null,-1)),it=[st],rt=pe(()=>s("path",{d:"M10.59 9.17 5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"},null,-1)),ct=[rt],ut=j({__name:"modeOfRepeat",props:{repeatMode:{type:Number,default:0}},emits:["change"],setup(d,{emit:p}){const u=d;let _=T(()=>u.repeatMode);const a=v=>{p("change",v)};return(v,e)=>{const h=M("Refresh"),n=M("el-icon"),L=M("el-tooltip");return S(),N("div",nt,[i(L,{content:"列表循环",placement:"top"},{default:c(()=>[o(_)==0?(S(),J(n,{key:0,class:"icon-m",onClick:e[0]||(e[0]=t=>a(1))},{default:c(()=>[i(h)]),_:1})):U("",!0)]),_:1}),i(L,{content:"单曲循环",placement:"top"},{default:c(()=>[o(_)==1?(S(),N("svg",{key:0,onClick:e[1]||(e[1]=t=>a(2)),class:"icon-m MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-i4bv87-MuiSvgIcon-root",focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24","data-testid":"RepeatOneIcon"},it)):U("",!0)]),_:1}),i(L,{content:"随机播放",placement:"top"},{default:c(()=>[o(_)==2?(S(),N("svg",{key:0,onClick:e[2]||(e[2]=t=>a(0)),class:"icon-m MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-i4bv87-MuiSvgIcon-root",focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24","data-testid":"ShuffleIcon"},ct)):U("",!0)]),_:1})])}}});const dt=W(ut,[["__scopeId","data-v-a527a3be"]]),vt=j({__name:"timeProgress",props:{value:{type:Number,default:0},cacheWidth:{type:Number,default:0},totalTime:{type:Number,default:0}},emits:["change","emitEnd"],setup(d,{emit:p}){const u=d;let _=T(()=>u.totalTime);const a=x=>{let $=parseInt(String(x)),E=String(Math.floor($/60)).padStart(2,"0"),r=String(Math.floor($%60)).padStart(2,"0");return E+":"+r},v=x=>(n.value==100&&p("emitEnd"),a(x)+"/ "+_.value),e=ae(),h=ae(),n=T(()=>u.value||0);let L=T(()=>u.cacheWidth>100?100:u.cacheWidth);const t=V("0%"),P=x=>{Se(()=>{let $=x.target,E=$.classList?.contains("el-slider__button-wrapper"),r=$.classList?.contains("el-slider__button"),m=E?$.offsetLeft:r?$.offsetParent.offsetLeft:x.offsetX;b.value=!0;let l=Number(m/(h.value?.clientWidth||1))||0,k=Number(_.value)*l;t.value=a(k)+"/ "+a(_.value)})},y=x=>{b.value=!1},b=V(!1),O=V({getBoundingClientRect(){return H.value}}),H=V({top:0,left:0,bottom:0,right:0}),B=x=>{let $=DOMRect.fromRect({width:0,height:0,x:x.clientX,y:x.clientY});H.value=$};me(()=>{document.addEventListener("mousemove",B)}),be(()=>{document.removeEventListener("mousemove",B)});const Q=x=>{p("change",x)};return(x,$)=>{const E=M("el-tooltip"),r=M("el-slider");return S(),N("div",{class:"time-progress-container",ref_key:"timeProgressContainerRef",ref:h},[i(E,{visible:b.value,"onUpdate:visible":$[0]||($[0]=m=>b.value=m),content:t.value,placement:"top",effect:"dark",trigger:"click","virtual-triggering":"","virtual-ref":O.value},null,8,["visible","content","virtual-ref"]),i(r,{class:"slider-ref",ref_key:"sliderRef",ref:e,"show-tooltip":!1,onMouseenter:P,onMousemove:P,onMouseleave:y,modelValue:o(n),"onUpdate:modelValue":Q,formatTooltip:v},null,8,["modelValue"]),s("div",{class:"cache-pro",style:G({width:o(L)+"%"})},null,4)],512)}}});const _t=W(vt,[["__scopeId","data-v-9264423b"]]),mt={class:"music-time-container"},pt=j({__name:"musicTime",props:{currentTime:{type:Number,default:0},totalTime:{type:Number,default:0}},setup(d){const p=d;let u=T(()=>a(p.currentTime)),_=T(()=>a(p.totalTime));V(0);const a=v=>{let e=parseInt(String(v)),h=String(Math.floor(e/60)).padStart(2,"0"),n=String(Math.floor(e%60)).padStart(2,"0");return h+":"+n};return(v,e)=>(S(),N("div",mt,A(o(u))+" / "+A(o(_)),1))}});const ft=W(pt,[["__scopeId","data-v-59ca1e92"]]),gt={key:0,class:"cur-music-container"},ht={class:"center"},yt={class:"musicName"},bt={class:"long long-cur"},St={class:"long-name"},Lt={class:"artist"},Mt={class:"time-progress"},Pt={class:"time-pro-left"},It=["src"],Vt={class:"time-pro-right"},Tt={class:"to-play-list"},wt=s("path",{d:"M3 10h11v2H3zm0-4h11v2H3zm0 8h7v2H3zm13-1v8l6-4z"},null,-1),xt=[wt],$t=j({__name:"curMusic",props:{modelValue:null,currentTime:{default:0},totalTime:{default:0},repeatMode:{default:0}},emits:["getLrc","update:modelValue","update:currentTime","update:totalTime","update:repeatMode","playNextOne","setPlayedListVisible"],setup(d,{expose:p,emit:u}){const _=d,a=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent),v=g=>{u("setPlayedListVisible")},e=T({get:()=>_.modelValue,set:g=>{u("update:modelValue",g)}}),h=T({get:()=>_.currentTime,set:g=>{u("update:currentTime",g)}}),n=T({get:()=>_.totalTime,set:g=>{u("update:totalTime",g)}}),L=T({get:()=>_.repeatMode,set:g=>{u("update:repeatMode",g)}}),t=g=>{L.value=g,localStorage.setItem("__repeat_mode",String(g))},P=async g=>{u("getLrc",g)},y=ae();let b=localStorage.getItem("_volume");y.value&&y.value?.volume&&(b||localStorage.setItem("_volume","0.4"),y.value.volume=Number(JSON.parse(b)));const O=g=>{y.value&&y.value.currentTime&&(h.value=y.value.currentTime);let w=-1;y.value&&y.value.currentTime&&typeof y.value.currentTime=="number"&&e.value.lrc&&e.value.lrc.length&&(w=JSON.parse(JSON.stringify(e.value.lrc)).reverse().findIndex(R=>R.time<=y.value.currentTime)),w!=-1&&(e.value.currentLong=e.value.lrc[w].text)},H=T(()=>{let g=Math.ceil(h.value),w=Math.ceil(n.value),R=Number((g/w).toFixed(2))*100;return R||0}),B=V(0),Q=g=>{let w=parseInt(String(g*n.value/100));h.value=w,y.value&&(y.value.currentTime=w)},x=g=>{const w=y.value?.buffered;let R;try{R=w.end(w.length-1)}catch{R=0}B.value=R/n.value*100},$=()=>{Z.error(`"${e.value.name}"播放错误,已移除`),e.value.hasError=!0,u("playNextOne",!0)},E=g=>{e.value.isPlaying=!0},r=g=>{e.value.isPlaying=!1},m=g=>{y.value.volume=Number(g)},l=g=>{try{y.value?.play()}catch{}},k=g=>{y.value?.pause(),e.value.isPlaying=!1},f=g=>{console.log("loadedmetadata~~")},X=g=>{console.log(g,"durationchange"),h.value=0;let w=y.value.duration;n.value=typeof w=="number"?w:0;let R=localStorage.getItem("_volume");y.value?.volume&&(R||localStorage.setItem("_volume","0.4"),y.value.volume=Number(JSON.parse(R))),z()},z=async()=>{try{await y.value?.play(),E()}catch(g){console.log("auto play failed because of browser security policy. ",g),$()}},D=V(0),F=g=>{clearTimeout(D.value),D.value=setTimeout(()=>{u("playNextOne",!1)},3e3)},I=T(()=>!e.value.loadingLrc&&e.value.isPlaying?"running":"paused"),q=g=>({backgroundImage:`url(${g.poster})`,animation:"7s linear infinite rotate360 "+I.value});return p({toPlayAudio:l,toPauseAudio:k,tryToAutoPlay:z}),(g,w)=>{const R=M("VideoPlay"),oe=M("el-icon"),fe=M("VideoPause"),ge=M("el-tooltip"),he=Le("loading");return o(e).id?(S(),N("div",gt,[s("div",{class:"left",onClick:w[0]||(w[0]=At=>P(o(e)))},[K(s("div",{class:"bgImg",style:G(q(o(e)))},null,4),[[he,o(e).loadingLrc]]),o(e).loadingLrc?U("",!0):(S(),N(_e,{key:0},[o(e).isPlaying?K((S(),J(oe,{key:1,class:"upIcon VideoPause cursorPointer",onClick:ce(k,["stop"])},{default:c(()=>[i(fe)]),_:1},8,["onClick"])),[[ee,!o(e).hasError]]):K((S(),J(oe,{key:0,class:"upIcon VideoPlay cursorPointer",onClick:ce(l,["stop"])},{default:c(()=>[i(R)]),_:1},8,["onClick"])),[[ee,!o(e).hasError]])],64))]),s("div",ht,[s("div",yt,[s("div",bt,A(o(e).loadingLrc?"正在下载歌词..":!o(e).lrc||!o(e).lrc.length?"暂无歌词":o(e).currentLong),1),s("div",St,[C(A(o(e).name)+"  ",1),s("span",Lt,A(o(e).artist),1)])]),s("div",Mt,[s("div",Pt,[i(_t,{currentTime:o(h),onEmitEnd:F,totalTime:o(n),value:o(H),cacheWidth:B.value,onChange:Q},null,8,["currentTime","totalTime","value","cacheWidth"]),s("audio",{style:{height:"0",opacity:"0"},ref_key:"audioRef",ref:y,src:o(e).url,onProgress:x,onLoadedmetadata:f,onDurationchange:X,preload:"auto",onTimeupdate:O,onError:$,onPlay:E,onEnded:F,onPause:r},null,40,It),i(ft,{currentTime:o(h),totalTime:o(n)},null,8,["currentTime","totalTime"])]),s("div",Vt,[o(a)?U("",!0):K((S(),J(at,{key:0,class:"cur-op-right",onChange:m},null,512)),[[ee,!o(e).hasError]]),i(ge,{class:"cur-op-right",content:"播放列表",placement:"top"},{default:c(()=>[s("div",Tt,[(S(),N("svg",{onClick:v,class:"icon-m MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-i4bv87-MuiSvgIcon-root",focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24","data-testid":"PlaylistPlayIcon"},xt))])]),_:1}),i(dt,{class:"mode-repeat cur-op-right",repeatMode:o(L),onChange:t},null,8,["repeatMode"])])])])])):U("",!0)}}});const kt={class:"music-container"},Nt={class:"music-inner"},Ct={class:"search-container"},Ot={key:0,class:"playedList-container"},zt={class:"title"},Rt={class:"dropdownSearchName textHiddenEllipsis"},Bt={class:"dropdownSearchName textHiddenEllipsis"},Et=j({__name:"music",setup(d){const p=V(!1),u=V(""),_=V(0),a=V(0);let v=localStorage.getItem("__repeat_mode"),e=V(v?JSON.parse(v):0);const h=V([]),n=V([]),L=V(),t=V({id:"",name:"",artist:"",poster:"",lrc:[],loadingLrc:!1}),P=V(!1),y=r=>{P.value=!P.value};let b=JSON.parse(localStorage.getItem("_playedList"))||[];b.length&&(P.value=!0,t.value={...b[0],isPlaying:!1},n.value=b),me(()=>{B(t.value)});const O=()=>{if(!u.value.trim()){Z.warning("关键词不能为空!");return}p.value=!0,fetch("/api/music/list?s="+encodeURIComponent(u.value)).then(r=>{if(r.ok)return r.json()}).then(r=>{h.value=r?r.data:[]}).finally(()=>{p.value=!1})},H=(r,m)=>{try{let l=JSON.parse(localStorage.getItem("_playedList"))||[];if(m){l=l.filter(f=>f.id!=m),l.length?localStorage.setItem("_playedList",JSON.stringify(l)):(localStorage.removeItem("_playedList"),P.value=!1,t.value.id=""),n.value=n.value.filter(f=>f.id).filter(f=>f.id!=m),n.value.length&&(t.value={...n.value[0],isPlaying:!0,lrc:t.value.lrc,loadingLrc:!1});return}if(l=l.some(f=>f.id==r.id)?l:[{...r,lrc:[],isPlaying:!1},...l].filter(f=>f.id),l.length)localStorage.setItem("_playedList",JSON.stringify(l));else{localStorage.removeItem("_playedList"),P.value=!1,t.value.id="";return}let k=[];l.length?k=n.value.some(f=>f.id==r.id)?n.value.map(f=>({...f,lrc:(f.id==r.id?r.lrc:f.lrc)||[]})):r?[r,...n.value]:l[0]:k=r?[r]:[],n.value=k.filter(f=>f.id)}catch{}},B=async r=>{if(!r.id)return;t.value.hasError=!1,t.value.loadingLrc=!0;let m=n.value.filter(l=>l.id).filter(l=>l.id==r.id);if(m.length)if(r.id===t.value.id){if(document.title=t.value.name,t.value.isPlaying?(t.value.isPlaying=!1,L.value?.toPauseAudio()):(t.value.isPlaying=!0,L.value?.tryToAutoPlay()),t.value.loadingLrc=!1,m[0].lrc&&m[0].lrc.length)return}else{_.value=0,a.value=0;let l=m[0].lrc,k=l&&l.length?l:[];t.value={...m[0],isPlaying:!0,lrc:k,loadingLrc:!1},document.title=t.value.name}else H(t.value);(!r.lrc||!r.lrc.length||!t.value.lrc||!t.value.lrc.length)&&(t.value={...r,lrc:[],isPlaying:!1,loadingLrc:!0},await fetch("/api/music/lrc/"+r.id).then(l=>{if(console.log("getLrc res",l),l.ok)return l.json()}).then(l=>{t.value.lrc=l?l.data:[],t.value.isPlaying=!0,document.title=t.value.name,H(t.value)}).catch(l=>{console.log("catch lrc",l),t.value.isPlaying=!1}).finally(()=>{t.value.loadingLrc=!1}))},Q=r=>{t.value.isPlaying=!1;let m=t.value.id;if(!r&&(n.value.length==1||e.value==1)){B(t.value);return}let l=n.value.findIndex(f=>f.id==m);if(r){H(t.value,m),n.value.length?(t.value={...n.value[0],hasError:!1,isPlaying:!0,lrc:t.value.lrc},P.value=!0):(t.value.id="",P.value=!1);return}let k=l+1;if(l==n.value.length-1&&(k=0),e.value==0)t.value={...n.value[k],lrc:t.value.lrc};else if(e.value==2){let f=JSON.parse(JSON.stringify(n.value));f.sort(()=>Math.random()-.5),f[0].id==m?t.value=f[1]:t.value=f[0]}B(t.value)},x=r=>{n.value=r},$=()=>{ke.confirm("confirm?","tooltip",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{Z({type:"success",message:"Delete completed"}),u.value="",n.value=[],localStorage.removeItem("_playedList"),t.value={id:"",name:"",artist:"",poster:"",lrc:[],loadingLrc:!1},P.value=!1,h.value=[],p.value=!1}).catch(()=>{})},E=(r,m)=>{if(r=="removeAllHistory")$();else if(m){let l=m,k=encodeURIComponent(l.name);r=="removeById"?H(l,l.id):r=="beTop"?(n.value=[l,...n.value.filter(f=>f.id!=l.id)],localStorage.setItem("_playedList",JSON.stringify(n.value))):r=="downLong"?window.open(`/api/music/download/${l.id}?name=encodeComponent(${l.name})`):r=="downLrc"?!l.lrc||!l.lrc.length?Z.warning(`"${l.name}"暂无相关歌词~`):window.open(`/api/music/lrc/download/${l.id}?name=${k}`):r=="addToPlayList"?n.value.some(f=>f.id==l.id)?Z.warning(`"${l.name}"已存在播放列表中~`):(n.value=[l,...n.value],localStorage.setItem("_playedList",JSON.stringify(n.value))):r=="searchArtist"?(u.value=l.artist,O()):r=="searchLongName"&&(u.value=l.name,O())}};return(r,m)=>{const l=M("el-button"),k=M("el-input"),f=M("MoreFilled"),X=M("el-icon"),z=M("el-dropdown-item"),D=M("el-dropdown-menu"),F=M("el-dropdown");return S(),N("div",kt,[i(Ge,{loading:p.value,"onUpdate:loading":m[0]||(m[0]=I=>p.value=I)},null,8,["loading"]),s("div",Nt,[s("div",Ct,[i(k,{modelValue:u.value,"onUpdate:modelValue":m[1]||(m[1]=I=>u.value=I),clearable:"",placeholder:"输入歌名/歌手名开始搜索",onKeyup:Me(O,["enter"])},{append:c(()=>[i(l,{type:"primary",disabled:!u.value.trim(),icon:o(de),onClick:O},null,8,["disabled","icon"])]),_:1},8,["modelValue","onKeyup"]),i(F,{class:"op-global",trigger:"click",onCommand:E},{dropdown:c(()=>[i(D,null,{default:c(()=>[i(z,{command:"removeAllHistory",icon:o(Ie)},{default:c(()=>[C("清空缓存数据")]),_:1},8,["icon"])]),_:1})]),default:c(()=>[i(X,{class:"more-action black"},{default:c(()=>[i(f)]),_:1})]),_:1})]),s("div",{class:ue(["list-container",{activeHeight:t.value.id}])},[h.value.length?(S(),J(ve,{key:0,currentPlayingObj:t.value,modelValue:h.value,onGetLrc:B},{rightContent:c(({row:I})=>[i(F,{trigger:"click",onCommand:q=>E(q,I)},{dropdown:c(()=>[i(D,null,{default:c(()=>[i(z,{command:"addToPlayList",icon:o(Ve)},{default:c(()=>[C("加入播放列表")]),_:1},8,["icon"]),i(z,{command:"downLong",icon:o(te)},{default:c(()=>[C("下载歌曲")]),_:1},8,["icon"]),i(z,{command:"downLrc",icon:o(te)},{default:c(()=>[C("下载歌词")]),_:1},8,["icon"])]),_:1})]),default:c(()=>[i(X,{class:"more-action black"},{default:c(()=>[i(f)]),_:1})]),_:2},1032,["onCommand"])]),_:1},8,["currentPlayingObj","modelValue"])):U("",!0),s("div",{class:ue(["bottom-list",{active:n.value.length&&P.value}])},[i($t,{ref_key:"curMusicRef",ref:L,onSetPlayedListVisible:y,onGetLrc:B,onSetMusicPlayed:x,onPlayNextOne:Q,modelValue:t.value,"onUpdate:modelValue":m[2]||(m[2]=I=>t.value=I),currentTime:_.value,"onUpdate:currentTime":m[3]||(m[3]=I=>_.value=I),totalTime:a.value,"onUpdate:totalTime":m[4]||(m[4]=I=>a.value=I),repeatMode:o(e),"onUpdate:repeatMode":m[5]||(m[5]=I=>ne(e)?e.value=I:e=I)},null,8,["modelValue","currentTime","totalTime","repeatMode"]),n.value.length&&P.value?(S(),N("div",Ot,[s("div",zt,"播放列表("+A(n.value.length)+")",1),i(ve,{hideListNumResult:"",currentPlayingObj:t.value,class:"playedList-lists",modelValue:n.value,onGetLrc:B},{rightContent:c(({row:I})=>[i(F,{trigger:"click",onCommand:q=>E(q,I)},{dropdown:c(()=>[i(D,null,{default:c(()=>[i(z,{command:"beTop",icon:o(Te)},{default:c(()=>[C("置顶")]),_:1},8,["icon"]),i(z,{command:"searchArtist",icon:o(we)},{default:c(()=>[C("搜索【"),s("div",Rt,A(I.artist),1),C("】")]),_:2},1032,["icon"]),i(z,{command:"searchLongName",icon:o(de)},{default:c(()=>[C("搜索【"),s("div",Bt,A(I.name),1),C("】")]),_:2},1032,["icon"]),i(z,{command:"removeById",icon:o(xe)},{default:c(()=>[C("移除")]),_:1},8,["icon"]),i(z,{command:"downLong",icon:o(te)},{default:c(()=>[C("下载歌曲")]),_:1},8,["icon"]),i(z,{command:"downLrc",icon:o(te)},{default:c(()=>[C("下载歌词")]),_:1},8,["icon"])]),_:2},1024)]),default:c(()=>[i(X,{class:"more-action"},{default:c(()=>[i(f)]),_:1})]),_:2},1032,["onCommand"])]),_:1},8,["currentPlayingObj","modelValue"])])):U("",!0)],2)],2)])])}}});const Ht=j({__name:"App",setup(d){return(p,u)=>(S(),J(Et))}});const Jt=W(Ht,[["__scopeId","data-v-a7970884"]]),re=Pe(Jt);re.use(Ne);for(const[d,p]of Object.entries($e))re.component(d,p);re.mount("#app");
